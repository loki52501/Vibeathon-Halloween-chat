# 🎃 Halloween Poe Chat

A spooky chat application inspired by Edgar Allan Poe where users connect through cryptic poems and mysterious questions. Built with Python FastAPI, React, PostgreSQL, and AWS Bedrock.

## 🌟 Features

- **Cryptic Registration**: Users provide 3 personal questions/answers that become a Poe-style poem
- **Mysterious Connections**: Other users must solve the riddle to connect
- **Dynamic Audio**: Ghostly background music that changes pitch based on answer accuracy
- **Real-time Chat**: WebSocket-powered instant messaging
- **Cooldown System**: 5 attempts with 2-minute cooldown for failed connections
- **AWS Bedrock Integration**: AI-powered poem generation using Claude models

## 🛠️ Tech Stack

### Backend
- **Python 3.8+** with FastAPI
- **PostgreSQL** database with SQLAlchemy ORM
- **AWS Bedrock** for AI poem generation (optional)
- **Psycopg2** for PostgreSQL connectivity

### Frontend
- **React 18** with modern hooks
- **Styled Components** for gothic styling
- **Framer Motion** for spooky animations
- **Web Audio API** for dynamic sound effects

## 🚀 Quick Start

### Prerequisites
- Python 3.8+ installed
- Node.js 16+ and npm installed
- PostgreSQL running locally
- AWS account (optional, for AI features)

### 1. Clone and Setup
```bash
# Clone the repository
git clone <your-repo-url>
cd halloween-themed-ai-agent

# Install Python dependencies
pip install -r backend/requirements.txt

# Install Node.js dependencies
cd frontend
npm install
cd ..
```

### 2. Database Setup
```bash
# Create PostgreSQL database
createdb poe_chat

# Set up environment variables
cp backend/env_example.txt backend/.env
# Edit backend/.env with your database credentials
```

### 3. Initialize Database
```bash
# Run the database setup script
python backend/setup_database.py
```

### 4. Start the Application
```bash
# Terminal 1 - Backend
cd backend
python main.py

# Terminal 2 - Frontend  
cd frontend
npm start
```

### 5. Access the Application
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs

## 📁 Project Structure

```
halloween-themed-ai-agent/
├── backend/
│   ├── main.py                 # Main FastAPI server
│   ├── database.py            # SQLAlchemy models
│   ├── setup_database.py      # Database initialization
│   ├── requirements.txt       # Python dependencies
│   ├── .env                   # Environment variables
│   └── env_example.txt        # Environment template
├── frontend/
│   ├── src/
│   │   ├── App.js            # Main React app
│   │   ├── components/       # React components
│   │   └── pages/           # Page components
│   ├── package.json         # Node.js dependencies
│   └── public/              # Static assets
├── knowledge_base/
│   └── poe_poems.json       # Poe poems for fallback
└── README.md               # This file
```

## 🔧 Configuration

### Environment Variables (backend/.env)
```env
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=poe_chat
DB_USER=your_username
DB_PASSWORD=your_password

# AWS Bedrock (optional)
AWS_ACCESS_KEY_ID=your_access_key
AWS_SECRET_ACCESS_KEY=your_secret_key
AWS_REGION=us-east-1
```

### AWS Bedrock Setup (Optional)
1. Go to AWS Console > Amazon Bedrock
2. Request access to "Anthropic Claude 3 Sonnet"
3. Wait for approval (usually takes a few minutes)
4. Add your AWS credentials to `backend/.env`

**Note**: The app works with fallback poem generation even without AWS Bedrock!

## 🎮 How to Use

### 1. Register a User
- Go to http://localhost:3000
- Click "Register" and fill in:
  - Username and password
  - 3 personal questions
  - 3 corresponding answers
- Get your cryptic poem generated by AI

### 2. Connect with Others
- View the list of other users
- Click "Attempt Connection" on someone
- Answer their 3 questions based on their poem
- Listen to the ghostly music change pitch!

### 3. Chat
- Successfully connect to chat in real-time
- Messages are saved and synchronized
- Enjoy the spooky atmosphere!

## 🧪 Testing

### Test the Backend
```bash
# Test API endpoints
curl http://localhost:8000/users
curl http://localhost:8000/docs
```

### Test the Frontend
- Open http://localhost:3000
- Register two users
- Make a successful connection attempt
- Start chatting!

## 🐛 Troubleshooting

### Common Issues

**Backend won't start:**
- Check PostgreSQL is running
- Verify database credentials in `.env`
- Run `python backend/setup_database.py`

**Frontend won't start:**
- Check Node.js version: `node --version`
- Clear npm cache: `npm cache clean --force`
- Delete `node_modules` and run `npm install`

**Chat not working:**
- Check if users are connected (use `/create-connection` endpoint)
- Verify database connections
- Check browser console for errors

**AWS Bedrock errors:**
- Verify AWS credentials
- Check model access permissions
- App will fallback to local poem generation

### Manual Connection Creation
If users can't connect automatically, create a manual connection:
```bash
curl -X POST "http://localhost:8000/create-connection?user1_username=user1&user2_username=user2"
```

## 🎨 Customization

### Adding New Poem Templates
Edit the `generate_poe_poem()` function in `backend/main.py` to add more Poe-style templates.

### Styling Changes
Modify `frontend/src/components/` for different gothic themes.

### Audio Effects
Update `frontend/src/components/AudioManager.js` for different sound effects.

## 📝 API Endpoints

- `POST /register` - Register new user
- `GET /users` - Get all users
- `POST /attempt-connection` - Attempt to connect
- `GET /connections/{user_id}` - Get user connections
- `GET /messages/{user_id}/{target_username}` - Get chat history
- `POST /send-message` - Send a message
- `POST /create-connection` - Manually create connection

## 🤝 Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## 📄 License

This project is licensed under the MIT License - see the LICENSE file for details.

## 🎃 Happy Haunting!

Enjoy your spooky chat experience! The spirits of Edgar Allan Poe are watching...

---

**Need help?** Check the troubleshooting section or open an issue on GitHub.

## 🔗 Quick Commands

```bash
# Start everything
cd backend && python main.py &
cd frontend && npm start

# Test connection
curl -X POST "http://localhost:8000/create-connection?user1_username=user1&user2_username=user2"

# View API docs
open http://localhost:8000/docs
```